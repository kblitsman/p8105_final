---
title: "Final Project" 
output: 
  flexdashboard::flex_dashboard:
    orientation: row
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(readr)
library(stringr)
library(ggplot2)
library(haven)
library(janitor)
library(shiny)
library(viridis)

saes = read_sas("./state_saes_final.sas7bdat") %>%
  clean_names() %>% 
  filter(pyear > 4 & pyear != 12 & area == 2) %>% 
  select(outname, pyearnm, area, stname, pyear, agegrp, est_total, nsel, ncomp, pop) %>% 
  mutate(agegrp = ifelse(agegrp == 0, "12 or older",
                         ifelse(agegrp == 1, "12 to 17",
                         ifelse(agegrp == 2, "18 to 25",
                         ifelse(agegrp == 3, "26 or older",
                         ifelse(agegrp == 4, "18 or older",
                         ifelse(agegrp == 5, "12 to 20", NA)))))))
```

Column {.sidebar}
-----------------------------------------------------------------------

```{r widgets, echo=FALSE}
# selectInput widget: State
states = saes %>% distinct(stname) %>% pull()
selectInput("state_choice", label = h3("Select state"),
            choices = states, selected = "Colorado")
renderPrint({ 
  input$state_choice
})

# selectInput widget: outcome
outcomes = saes %>% distinct(outname) %>% pull()
selectInput("outcome_choice", label = h3("Select outcome"),
            choices = outcomes, selected = "marijuana use in the past year")
renderPrint({ 
  input$outcome_choice
})

# radioButtons widget: age group
age_group = saes %>% distinct(agegrp) %>% pull()
radioButtons("age_group", label = h3("Choose age group"),
    choices = age_group, 
    selected = "18 or older")
renderPrint({ 
  input$age_group
})


```


Row
-----------------------------------------------------------------------

### Time-series graph

```{r}
renderPlotly({
  saes %>% 
    filter(outname == input$outcome_choice,
           agegrp == input$age_group,
           stname == input$state_choice) %>% 
    plot_ly(x = ~pyearnm, y = ~est_total, type = "scatter", mode = "markers",
          alpha = 0.5, color = viridis)
})
```

